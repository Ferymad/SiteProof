# Story 1B.1: Project Setup & Development Environment (Enterprise Track)

## Status
Draft

## Story
**As a** developer,
**I want** a properly configured development environment with CI/CD pipeline,
**so that** I can build and deploy features consistently across environments.

## Acceptance Criteria
1. **Monorepo Setup**: Next.js frontend and Django backend in single repository with proper folder structure
2. **Database Configuration**: Supabase project configured with PostgreSQL, authentication, and storage buckets
3. **Environment Management**: Separate dev/staging/production environments with consistent configurations
4. **CI/CD Pipeline**: GitHub Actions workflow for automated testing and deployment to Railway + Vercel
5. **Monitoring Setup**: Sentry error tracking and Supabase monitoring dashboard configured
6. **API Documentation**: Auto-generated OpenAPI docs from Django REST Framework for future integrations

## Tasks / Subtasks
- [ ] Task 1: Initialize Monorepo Structure (AC: 1)
  - [ ] Create npm workspaces configuration in root package.json
  - [ ] Set up apps/web directory for Next.js frontend
  - [ ] Set up apps/api directory for Django backend  
  - [ ] Set up packages/shared directory for TypeScript interfaces/constants
  - [ ] Create complete source tree structure per architecture document
- [ ] Task 2: Configure Development Tools (AC: 1)
  - [ ] Initialize Next.js 14.2+ with TypeScript and App Router
  - [ ] Initialize Django 5.0+ with Django REST Framework
  - [ ] Configure Tailwind CSS 3.4+ with construction-specific customization
  - [ ] Set up Zustand 4.5+ for state management
  - [ ] Configure development Docker compose for local development
- [ ] Task 3: Database and Authentication Setup (AC: 2)
  - [ ] Create Supabase project with PostgreSQL 15+ and pgvector
  - [ ] Configure Supabase Auth with JWT tokens and RLS policies
  - [ ] Set up Supabase Storage buckets for voice notes, images, PDFs
  - [ ] Configure Redis 7.2+ on Railway for session cache and queues
- [ ] Task 4: Environment Configuration (AC: 3)
  - [ ] Create .env.example with all required environment variables
  - [ ] Set up development, staging, production environment configs
  - [ ] Configure environment variable access through config objects
  - [ ] Set up Railway EU-West deployment configuration
  - [ ] Configure Vercel deployment with EU priority CDN
- [ ] Task 5: CI/CD Pipeline (AC: 4)
  - [ ] Create GitHub Actions workflow for testing (test.yaml)
  - [ ] Create GitHub Actions workflow for deployment (deploy.yaml)
  - [ ] Configure automated testing for both frontend and backend
  - [ ] Set up automated deployment to Railway (Django) and Vercel (Next.js)
- [ ] Task 6: Monitoring and Documentation (AC: 5, 6)
  - [ ] Configure Sentry error tracking for both frontend and backend
  - [ ] Set up Supabase monitoring dashboard
  - [ ] Configure Django REST Framework for auto-generated OpenAPI docs
  - [ ] Create basic README with setup and deployment instructions

## Dev Notes

### Previous Story Insights
No specific guidance found in architecture docs - this is the first story.

### Data Models
This story focuses on infrastructure setup. Core data models for future implementation defined in architecture:
- Company, User, Project, WhatsAppMessage, ProcessedContent, EvidencePackage, ValidationQueue
[Source: architecture/data-models.md]

### API Specifications
- RESTful API communication using OpenAPI 3.0 specification
- Django REST Framework for API development with auto-generated docs
- JWT token-based authentication for future mobile app and integrations
[Source: architecture/api-specification.md, Source: architecture/tech-stack.md]

### Component Specifications
**Frontend Architecture:**
- Next.js 14+ with App Router, TypeScript 5.3+, Tailwind CSS 3.4+ with Radix UI
- Atomic design pattern: atoms/ molecules/ organisms/ templates/
- Zustand 4.5+ for lightweight state management
- Mobile-first responsive design starting from 375px base
[Source: architecture/frontend-architecture.md, Source: architecture/tech-stack.md]

**Backend Architecture:**
- Django 5.0+ with Django REST Framework
- App-based organization: authentication/, projects/, processing/, validation/, evidence/
- Repository pattern for data access abstraction
[Source: architecture/backend-architecture.md, Source: architecture/tech-stack.md]

### File Locations
Complete source tree structure must be created as defined in high-level-architecture.md:
- Root: construction-evidence-machine/
- Apps: apps/web/ (Next.js), apps/api/ (Django)
- Packages: packages/shared/ (TypeScript types), packages/ui/ (future components)
- Docs: docs/stories/ (organized by epic)
- Testing: e2e/ (Playwright tests)
- Config: .bmad-core/, .github/workflows/
[Source: architecture/high-level-architecture.md#complete-source-tree]

### Testing Requirements
**Testing Pyramid Structure:**
- Frontend Unit: Vitest + React Testing Library 1.2+ / 14+
- Backend Unit: pytest 8.0+ with Django Test integration
- E2E Testing: Playwright 1.40+ for cross-browser mobile testing
- Minimum 80% coverage requirement for business logic
- Test organization: apps/web/src/__tests__/, apps/api/tests/, e2e/
[Source: architecture/testing-strategy.md, Source: architecture/coding-standards.md]

### Technical Constraints
**Platform Requirements:**
- Frontend: Vercel deployment with global CDN, EU priority
- Backend: Railway EU-West (Ireland) for data residency  
- Database: Supabase EU-West (Dublin) for GDPR compliance
- Node.js/npm workspaces for monorepo (upgrade to Turborepo later)
[Source: architecture/high-level-architecture.md#platform-and-infrastructure-choice]

**Critical Fullstack Rules:**
- Environment variables accessed only through config objects, never process.env directly
- Type sharing through packages/shared, import from there always
- All API routes must use standard error handler
- File uploads validated on both frontend and backend
[Source: architecture/coding-standards.md#critical-fullstack-rules]

### Testing
**Test File Locations:**
- Frontend tests: apps/web/src/__tests__/ (components/, pages/, services/, utils/)
- Backend tests: apps/api/tests/ (unit/, integration/, fixtures/)
- E2E tests: e2e/ (auth.spec.ts, processing.spec.ts, etc.)
[Source: architecture/testing-strategy.md#test-organization]

**Testing Standards:**
- Use Vitest + React Testing Library for frontend unit tests
- Use pytest + Django Test for backend unit tests  
- Use Playwright for E2E tests with mobile testing support
- Maintain 80% minimum coverage for business logic
- Test file naming: Component.test.tsx, test_*.py
[Source: architecture/testing-strategy.md, Source: architecture/coding-standards.md]

**Testing Frameworks:**
- Frontend: Vitest 1.2+, React Testing Library 14+, fast Jest-compatible
- Backend: pytest 8.0+ with Django integration, fixtures, coverage
- E2E: Playwright 1.40+ with cross-browser and mobile testing support
[Source: architecture/tech-stack.md]

**Testing Requirements for This Story:**
- Set up all testing frameworks and configurations
- Create basic test structure and sample tests
- Configure test commands in package.json scripts
- Ensure CI/CD pipeline runs all tests before deployment

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-08-07 | 1.0 | Initial story creation with full architecture context | Bob (Scrum Master) |
| 2025-08-07 | 1.1 | Moved to Epic 1B (Enterprise Track) via course correction | Bob (Scrum Master) |

## Dev Agent Record
*This section will be populated by the development agent during implementation*

### Agent Model Used
*To be filled by dev agent*

### Debug Log References
*To be filled by dev agent*

### Completion Notes List
*To be filled by dev agent*

### File List
*To be filled by dev agent*

## QA Results
*Results from QA Agent review will be populated here after story implementation*